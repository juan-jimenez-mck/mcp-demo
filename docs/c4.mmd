%% C4Context
    %%   title System Context diagram for Internet Banking System
      
    %%   Enterprise_Boundary(b0, "BankBoundary0") {
    %%     Person(customerA, "Banking Customer A", "A customer of the bank, with personal bank accounts.")
    %%     Person(customerB, "Banking Customer B")
    %%     Person_Ext(customerC, "Banking Customer C", "desc")

    %%     Person(customerD, "Banking Customer D", "A customer of the bank, <br/> with personal bank accounts.")

    %%     System(SystemAA, "Internet Banking System", "Allows customers to view information about their bank accounts, and make payments.")

    %%     Enterprise_Boundary(b1, "BankBoundary") {

    %%       SystemDb_Ext(SystemE, "Mainframe Banking System", "Stores all of the core banking information about customers, accounts, transactions, etc.")

    %%       System_Boundary(b2, "BankBoundary2") {
    %%         System(SystemA, "Banking System A")
    %%         System(SystemB, "Banking System B", "A system of the bank, with personal bank accounts. next line.")
    %%       }

    %%       System_Ext(SystemC, "E-mail system", "The internal Microsoft Exchange e-mail system.")
    %%       SystemDb(SystemD, "Banking System D Database", "A system of the bank, with personal bank accounts.")

    %%       Boundary(b3, "BankBoundary3", "boundary") {
    %%         SystemQueue(SystemF, "Banking System F Queue", "A system of the bank.")
    %%         SystemQueue_Ext(SystemG, "Banking System G Queue", "A system of the bank, with personal bank accounts.")
    %%       }
    %%     }
    %%   }

    %%   BiRel(customerA, SystemAA, "Uses")
    %%   BiRel(SystemAA, SystemE, "Uses")
    %%   Rel(SystemAA, SystemC, "Sends e-mails", "SMTP")
    %%   Rel(SystemC, customerA, "Sends e-mails to")

    %%   UpdateElementStyle(customerA, $fontColor="red", $bgColor="grey", $borderColor="red")
    %%   UpdateRelStyle(customerA, SystemAA, $textColor="blue", $lineColor="blue", $offsetX="5")
    %%   UpdateRelStyle(SystemAA, SystemE, $textColor="blue", $lineColor="blue", $offsetY="-10")
    %%   UpdateRelStyle(SystemAA, SystemC, $textColor="blue", $lineColor="blue", $offsetY="-40", $offsetX="-50")
    %%   UpdateRelStyle(SystemC, customerA, $textColor="red", $lineColor="red", $offsetX="-50", $offsetY="20")

%% 

C4Context
    title ğŸ¤– ChaQi System Architecture
    Person(user, "Sales Rep", "Chat interactions")
    System_Ext(anthropic, "ğŸ§  Anthropic", "LLM Model")
    System_Boundary(system, "ChaQi") {
        Container(ui, "âš›ï¸ UI", "React/TS", "Chat interface")
        Container(api, "ğŸš€ API", "NestJS", "Orchestration")
      
        Boundary(mcp, "MCP Ecosystem", "") {
            Container(mcpRoot, "ğŸŒŸ Root MCP", "Orchestrator")
            Boundary(mcpServers, "", "") {
                Container(mcpCatalog, "ğŸ“¦ Catalog MCP", "MCP")
                Container(mcpCrm, "ğŸ‘¥ CRM MCP", "MCP") 
                Container(mcpErp, "ğŸ“Š ERP MCP", "MCP")
                Container(mcpNotification, "ğŸ”” Notifications MCP", "MCP")
            }
        }
        Boundary(platforms, "Platforms", "") {
            ContainerDb(database, "Main DB", "SQL Database", "")
        }
    }
    
    Rel(user, ui, "Ask question", "HTTPS")
    BiRel(ui, api, "Stream conversation", "HTTPS")
    BiRel(api, anthropic, "Stream conversation", "HTTPS")
    BiRel(api, mcpRoot, "Trigger tools", "MCP")
    BiRel(mcpRoot, mcpCatalog, "ğŸ”—", "MCP")
    BiRel(mcpRoot, mcpCrm, "ğŸ”—", "MCP")
    BiRel(mcpRoot, mcpErp, "ğŸ”—", "MCP")
    BiRel(mcpRoot, mcpNotification, "ğŸ”—", "MCP")
    BiRel(mcpCatalog, database, "Query", "")
    BiRel(mcpCrm, database, "Query", "")
    BiRel(mcpErp, database, "Query", "")
    BiRel(mcpNotification, database, "Query", "")



    UpdateLayoutConfig($c4ShapeInRow="4", $c4BoundaryInRow="1")

 
%%     %% System_Boundary(system, "ChaQi") {
%%     %%     Container(ui, "âš›ï¸ React UI", "React/TS", "Chat interface")
%%     %%     Container(api, "ğŸš€ NestJS API", "NestJS", "Orchestration")
%%     %%     %% ContainerDb(database, "Database", "SQL Database", "")
%%     %%     Boundary(mcpServers, "MCP Servers", "") {
%%     %%         Container(mcpCatalog, "ğŸ“¦ Catalog", "MCP")
%%     %%         Container(mcpCrm, "ğŸ‘¥ CRM", "MCP") 
%%     %%         Container(mcpErp, "ğŸ“Š ERP", "MCP")
%%     %%         Container(mcpNotification, "ğŸ”” Notifications", "MCP")
%%     %%     }
%%     %%     Boundary(mcpServdfers, "MCP Servers", "") {
%%     %%         ContainerDb(databadse, "Datddabase", "SQL Datadbase", "")
%%     %%     }
%%     %%     Boundary(mcpServdfdders, "MCP Servers", "") {
%%     %%         ContainerDb(databadse, "Datddabase", "SQL Datadbase", "")
%%     %%     }
%%     %%     Boundary(mcpServdferaas, "MCP rs", "") {
%%     %%         ContainerDb(databadse, "Datddabase", "SQL Datadbase", "")
%%     %%     }
%%     %% }

    
%%     %% System_Boundary(system, "ğŸ¢ AI Agent Platform") {
%%     %%     Container(ui, "âš›ï¸ React UI", "React/TS", "Chat interface")
%%     %%     Container(api, "ğŸš€ NestJS API", "NestJS", "Orchestration")
%%     %%     Container(mcpRoot, "ğŸŒŸ Root MCP", "Hub", "Orchestrator")

%%     %%     Deployment_Node(database, "bigbank-db02", "Ubuntu 16.04 LTS") {
%%     %%         ContainerDb(database, "Database", "Relational Database Schema", "Stores user registration information, hashed authentication credentials, access logs, etc.")
%%     %%                 Container_Boundary(mcpServers, "Connected Servers") {
%%     %%         Container(mcpCatalog, "ğŸ“¦ Catalog", "MCP")
%%     %%         Container(mcpCrm, "ğŸ‘¥ CRM", "MCP") 
%%     %%         Container(mcpErp, "ğŸ“Š ERP", "MCP")
%%     %%         Container(mcpNotification, "ğŸ”” Notifications", "MCP")
%%     %%     }
%%     %%     }   
%%     %%     Deployment_Node(mcpRoot, "bigbank-mcp01", "Ubuntu 16.04 LTS") {
%%     %%         Container(mcpRoot, "ğŸŒŸ Root MCP", "Hub", "Orchestrator")
%%     %%     }
%%     %% }
    
    
%%     %% System_Ext(anthropic, "ğŸ§  Anthropic", "LLM Model")


%%     %% %% %% Main user flow
%%     %% Rel(user, ui, "ğŸ’¬ Chat", "HTTPS")
%%     %% Rel(ui, api, "Sends message", "SSE")

    
%%     %% %% AI orchestration flow
%%     %% Rel(api, mcpRoot, "ğŸ› ï¸ Tools", "MCP")
%%     %% Rel(api, anthropic, "ğŸ¯ Requests", "HTTPS")
%%     %% Rel(anthropic, api, "âš¡ Responses", "Stream")
%%     %% Rel(api, mcpRoot, "ğŸ”„ Execute", "MCP")
%%     %% BiRel(api, database, "", "MCP")
    
%%     %% %% MCP server mounting
%%     %% Rel(mcpRoot, mcpCatalog, "ğŸ”—", "MCP")
%%     %% Rel(mcpRoot, mcpCrm, "ğŸ”—", "MCP")
%%     %% Rel(mcpRoot, mcpErp, "ğŸ”—", "MCP")
%%     %% Rel(mcpRoot, mcpNotification, "ğŸ”—", "MCP")
%%     %% BiRel(mcpCatalog, database, "", "MCP")
%%     %% BiRel(mcpCrm, database, "", "MCP")
%%     %% BiRel(mcpErp, database, "", "MCP")
%%     %% BiRel(mcpNotification, database, "", "MCP")

%%     %% %% UpdateElementStyle(user, $bgColor="#667EEA", $fontColor="#FFFFFF", $borderColor="#5A67D8")
%%     %% %% UpdateElementStyle(ui, $bgColor="#4FD1C7", $fontColor="#FFFFFF", $borderColor="#38B2AC")
%%     %% %% UpdateElementStyle(api, $bgColor="#9F7AEA", $fontColor="#FFFFFF", $borderColor="#805AD5")
%%     %% %% UpdateElementStyle(anthropic, $bgColor="#F6AD55", $fontColor="#FFFFFF", $borderColor="#ED8936")
%%     %% %% UpdateElementStyle(mcpRoot, $bgColor="#68D391", $fontColor="#FFFFFF", $borderColor="#48BB78")
%%     %% %% UpdateElementStyle(mcpCatalog, $bgColor="#81E6D9", $fontColor="#2D3748", $borderColor="#4FD1C7")
%%     %% %% UpdateElementStyle(mcpCrm, $bgColor="#90CDF4", $fontColor="#2D3748", $borderColor="#63B3ED")
%%     %% %% UpdateElementStyle(mcpErp, $bgColor="#A78BFA", $fontColor="#FFFFFF", $borderColor="#8B5CF6")
%%     %% %% UpdateElementStyle(mcpNotification, $bgColor="#FBB6CE", $fontColor="#2D3748", $borderColor="#F687B3")